---
apiVersion: v1
kind: Service
metadata:
  name: cloudcore-lb
  namespace: kube-system
  annotations:
    # Cilium LoadBalancer IPAM - allocate from homelab-pool
    io.cilium/lb-ipam-ips: "192.168.1.66"
    # Advertised via Tailscale subnet router (192.168.1.64/28)
spec:
  type: LoadBalancer
  loadBalancerIP: 192.168.1.66
  # CloudStream tunnel is stateful - edge nodes connect to one CloudCore pod
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800
  selector:
    k8s-app: kubeedge
    kubeedge: cloudcore
  ports:
    - name: cloudhub
      port: 10350
      protocol: TCP
      targetPort: 10350
    - name: quic
      port: 10001
      protocol: UDP
      targetPort: 10001
    - name: websocket
      port: 10000
      protocol: TCP
      targetPort: 10000
    - name: cloudhub-https
      port: 10002
      protocol: TCP
      targetPort: 10002
    - name: streamport
      port: 10003
      protocol: TCP
      targetPort: 10003
    - name: cloudstream
      port: 10004
      protocol: TCP
      targetPort: 10004
