# KubeElasti Helm chart deployment
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: kubeeelasti
  namespace: inference
spec:
  interval: 5m
  url: https://truefoundry.github.io/KubeElasti/
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kubeeelasti
  namespace: inference
spec:
  interval: 5m
  chart:
    spec:
      chart: elasti
      version: "0.1.x"
      sourceRef:
        kind: HelmRepository
        name: kubeeelasti
        namespace: inference
  values:
    elastiController:
      manager:
        env:
          # Default Prometheus address for all ElastiServices
          prometheusTriggerServerAddress: http://kube-prometheus-stack-prometheus.observability.svc:9090
          # How often to check Prometheus for scale decisions
          pollingInterval: 30s
        resources:
          limits:
            cpu: 200m
            memory: 128Mi
          requests:
            cpu: 100m
            memory: 64Mi
    elastiResolver:
      replicas: 2
      proxy:
        env:
          # Max time to wait for cold start (seconds)
          reqTimeout: "600"
          # Queue settings
          queueSize: "1000"
          maxQueueConcurrency: "50"
        resources:
          limits:
            cpu: 200m
            memory: 128Mi
          requests:
            cpu: 100m
            memory: 64Mi
