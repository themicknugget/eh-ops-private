---
# TunnelBinding routes traffic from Cloudflare to the internal gateway
apiVersion: networking.cfargotunnel.com/v1alpha1
kind: TunnelBinding
metadata:
  name: external-gateway-binding
  namespace: cloudflare-operator-system
subjects:
  - name: external-gateway
    spec:
      # Wildcard domain for all subdomains
      fqdn: "*.${DOMAIN1}"
      protocol: https
      # Route to Cilium Gateway HTTPS listener (HTTP listener has empty routes in Cilium)
      target: https://cilium-gateway-external-gateway.kube-system.svc.cluster.local:443
      # Skip TLS verification since gateway uses internal wildcard cert
      noTlsVerify: true
tunnelRef:
  kind: ClusterTunnel
  name: eh-ops-cluster
  # Allow DNS updates for subdomains
  disableDNSUpdates: false
