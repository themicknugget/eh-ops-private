apiVersion: inference.eh-ops.io/v1alpha1
kind: InferenceBackend
metadata:
  name: whisper-cpp
  namespace: inference
spec:
  image:
    repository: ghcr.io/kth8/whisper-server-vulkan
    tag: latest
  port: 8080
  command:
    - /usr/local/bin/whisper-server
  args:
    - -m
    - $(HF_SOURCE)
    - --host
    - 0.0.0.0
    - --port
    - "8080"
    - --inference-path
    - /v1/audio/transcriptions
  readinessPath: /health
  securityContext:
    capabilities:
      add:
        - SYS_PTRACE
    seccompProfile:
      type: Unconfined
  volumes:
    - name: dri
      hostPath:
        path: /dev/dri
    - name: kfd
      hostPath:
        path: /dev/kfd
  volumeMounts:
    - name: dri
      mountPath: /dev/dri
    - name: kfd
      mountPath: /dev/kfd
  gpu:
    shared: true
