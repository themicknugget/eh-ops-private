# API server configuration - connect directly to bypass service
k8sServiceHost: 127.0.0.1
k8sServicePort: 7445

# IPAM configuration
ipam:
  mode: kubernetes

# Native routing mode for direct node-to-node communication
routingMode: native
directRoutingDevice: eno1
ipv4NativeRoutingCIDR: 10.244.0.0/16
autoDirectNodeRoutes: true

# Enable kube-proxy replacement
kubeProxyReplacement: true

# Gateway API support
gatewayAPI:
  enabled: true

# WireGuard encryption
encryption:
  enabled: true
  type: wireguard

# L2 announcements for LoadBalancer services
l2announcements:
  enabled: true

loadBalancer:
  acceleration: disabled

bpf:
  enableTCX: false

# Talos-specific cgroup configuration
cgroup:
  autoMount:
    enabled: false
  hostRoot: /sys/fs/cgroup

# Security contexts for Talos compatibility
securityContext:
  capabilities:
    ciliumAgent:
      - CHOWN
      - KILL
      - NET_ADMIN
      - NET_RAW
      - IPC_LOCK
      - SYS_ADMIN
      - SYS_RESOURCE
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID
    cleanCiliumState:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE

# Identity allocation mode for enhanced security
identityAllocationMode: crd

# Resource limits for production readiness
resources:
  limits:
    memory: 500Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Operator configuration with Prometheus metrics
operator:
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
  prometheus:
    enabled: true
    port: 9963

l2podAnnouncements:
  enabled: true

# Bandwidth manager for QoS
bandwidthManager:
  enabled: true
  bbr: true

# Enable PMTU discovery for mixed MTU environments (1500/9000)
pmtuDiscovery:
  enabled: true

# Tolerations for control plane nodes and agent-not-ready deadlock prevention
tolerations:
- key: node-role.kubernetes.io/control-plane
  operator: Exists
  effect: NoSchedule
- key: node.cilium.io/agent-not-ready
  operator: Exists
  effect: NoSchedule
- key: node.kubernetes.io/not-ready
  operator: Exists
  effect: NoSchedule
- key: workload-type
  operator: Equal
  value: heavy
  effect: NoSchedule
