---
# Unified Control Plane LoadBalancer
# Exposes both Kubernetes API (6443) and Talos API (50000, 50001)
apiVersion: v1
kind: Service
metadata:
  name: api-server-lb
  namespace: kube-system
  annotations:
    io.cilium/lb-ipam-ips: "192.168.1.50"
spec:
  type: LoadBalancer
  ports:
  - name: api-server
    port: 6443
    protocol: TCP
    targetPort: 6443
  - name: talos-api
    port: 50000
    protocol: TCP
    targetPort: 50000
  - name: trustd
    port: 50001
    protocol: TCP
    targetPort: 50001
  externalTrafficPolicy: Cluster
  sessionAffinity: None
---
# Manual endpoints for all control plane services
apiVersion: v1
kind: Endpoints
metadata:
  name: api-server-lb
  namespace: kube-system
subsets:
- addresses:
  - ip: 192.168.1.51
  - ip: 192.168.1.52
  - ip: 192.168.1.53
  ports:
  - name: api-server
    port: 6443
    protocol: TCP
  - name: talos-api
    port: 50000
    protocol: TCP
  - name: trustd
    port: 50001
    protocol: TCP
